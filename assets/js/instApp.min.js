function loadOnScroll(t,o,e,a,n){var l,s=0,i=document.body;window.addEventListener("scroll",function(){var r=window.pageYOffset;r>s&&r>=i.scrollHeight-window.innerHeight-50&&(l=o(t[e].pagination.next_url+"&callback=JSON_CALLBACK",{},{getPhotos:{method:"jsonp"}}),t[e]=l.getPhotos(function(){t[a]=t[a].concat(t[e].data),n&&n(t,$http)})),s=r})}var myApp=angular.module("instApp",["ngRoute","ngResource"]);myApp.config(function(t){t.when("/search/",{templateUrl:"../templates/search.html",controller:"Search"}).when("/profile/:id",{templateUrl:"../templates/profile.html",controller:"Profile"}).when("/profile/:id/followers/",{templateUrl:"../templates/followers.html",controller:"Followers"}).when("/profile/:id/follows/",{templateUrl:"../templates/follows.html",controller:"Follows"}).when("/",{templateUrl:"../templates/timeline.html",controller:"Timeline"}).when("/about/",{templateUrl:"../templates/about.html"})}),myApp.controller("Profile",function(t,o,e,a){t.token=localStorage.getItem("accessToken"),t.userId=localStorage.getItem("userId");var n=o("https://api.instagram.com/v1/users/:id?access_token=:token&callback=JSON_CALLBACK",{id:"@id",token:"@token"},{getUserData:{method:"jsonp"}});t.Userdata=n.getUserData({id:a.id||t.userId,token:t.token},function(){t.user=t.Userdata.data}),t.relationship=function(e){var a="none"===e.status.outgoing_status?"follow":"unfollow",n=o("../php/followMe.php",{action:"@action",access_token:"@token",userId:"@id"}),l=n.get({action:a,access_token:t.token,userId:e.id},function(){e.status=l.data})},t.followMe=function(){e({method:"GET",params:{action:"follow",access_token:t.token,userId:1980608},url:"../php/followMe.php"}).success(function(){})},t.like=function(o){var a=o.user_has_liked?"DELETE":"POST";e({method:"GET",params:{access_token:t.token,photoId:o.id,action:a},url:"../php/like.php"}).success(function(){"POST"===a?(o.user_has_liked=!0,o.likes.count=o.likes.count+1):(o.user_has_liked=!1,o.likes.count=o.likes.count-1)})}}),myApp.controller("Search",function(t,o){var e=o("https://api.instagram.com/v1/media/popular/?access_token=:token&callback=JSON_CALLBACK",{token:"@token"},{getPopular:{method:"jsonp"}}),a=e.getPopular({token:t.token},function(){t.searchTimeline=a.data}),n=o("https://api.instagram.com/v1/tags/:hashtag/media/recent?&access_token=:token&callback=JSON_CALLBACK",{hashtag:"@hashtag",token:"@token"},{find:{method:"jsonp"}});t.search=function(){var o=n.find({hashtag:t.hashtag,token:t.token},function(){t.searchTimeline=o.data})},t.$watch("hashtag",function(){t.hashtag&&(t.hashtag=t.hashtag.replace(/\s+/g,""))})}),myApp.controller("Timeline",function(t,o){var e=o("https://api.instagram.com/v1/users/self/feed?access_token=:token&callback=JSON_CALLBACK",{token:"@token"},{getTimeline:{method:"jsonp"}});t.timelineData=e.getTimeline({token:t.token},function(){t.timeline=t.timelineData.data}),loadOnScroll(t,o,"timelineData","timeline")}),myApp.controller("Followers",function(t,o,e){o("https://api.instagram.com/v1/users/:id/followed-by?access_token=:token&callback=JSON_CALLBACK",{id:"@id",token:"@id"},{getAuthors:{method:"jsonp"}});t.followersData=followees.getAuthors({id:e.id,token:t.token},function(){t.followers=t.followersData.data,myApp.addStatus(t,$http)}),loadOnScroll(t,o,"followersData","followers",myApp.addStatus)}),myApp.controller("Follows",function(t,o,e){var a=o("https://api.instagram.com/v1/users/:id/follows?access_token=:token&callback=JSON_CALLBACK",{id:"@id",token:"@id"},{getAuthors:{method:"jsonp"}});t.followersData=a.getAuthors({id:e.id,token:t.token},function(){t.followers=t.followersData.data,myApp.addStatus(t,$http)}),loadOnScroll(t,o,"followersData","followers",myApp.addStatus)}),myApp.controller("GetProfilePhotos",function(t,o,e){var a=o("https://api.instagram.com/v1/users/:id/media/recent?access_token=:token&callback=JSON_CALLBACK",{id:"@id",token:"@token"},{getPhotos:{method:"jsonp"}});t.profilePhotos=a.getPhotos({id:e.id||t.userId,token:t.token},function(){t.userPhotos=t.profilePhotos.data}),loadOnScroll(t,o,"profilePhotos","userPhotos")}),myApp.addStatus=function(t,o){angular.forEach(t.followers,function(e,a){o.jsonp("https://api.instagram.com/v1/users/"+t.followers[a].id+"/relationship?access_token="+t.token+"&callback=JSON_CALLBACK").success(function(o){t.followers[a].status=o.data})})},myApp.config(function(t){t.resourceUrlWhitelist(["self","http://*.s3.amazonaws.com/**"])});