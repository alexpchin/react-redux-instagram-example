var myApp=angular.module("instApp",[]).config(function(o){o.when("/search/",{templateUrl:"../templates/search.html",controller:"Search"}).when("/profile/:id",{templateUrl:"../templates/profile.html",controller:"Profile"}).when("/profile/:id/followers/",{templateUrl:"../templates/followers.html",controller:"Followers"}).when("/profile/:id/follows/",{templateUrl:"../templates/follows.html",controller:"follows"}).when("/",{templateUrl:"../templates/timeline.html",controller:"Timeline"}).when("/about/",{templateUrl:"../templates/about.html"})}).controller("Profile",function(o,e,t){o.token=localStorage.getItem("accessToken"),o.userId=localStorage.getItem("userId"),t.id||(t.id=o.userId),e.jsonp("https://api.instagram.com/v1/users/"+t.id+"?access_token="+o.token+"&callback=JSON_CALLBACK").success(function(e){o.user=e.data}),o.relationship=function(t){if("none"===t.status.outgoing_status)var s="follow";else s="unfollow";e({method:"GET",params:{action:s,access_token:o.token,userId:t.id},url:"../php/followMe.php"}).success(function(o){t.status=o.data})},o.followMe=function(){e({method:"GET",params:{action:"follow",access_token:o.token,userId:1980608},url:"../php/followMe.php"}).success(function(o){console.log(o)})},o.like=function(t){if(t.user_has_liked)var s="DELETE";else s="POST";e({method:"GET",params:{access_token:o.token,photoId:t.id,action:s},url:"../php/like.php"}).success(function(){"POST"===s?(t.user_has_liked=!0,t.likes.count=t.likes.count+1):(t.user_has_liked=!1,t.likes.count=t.likes.count-1)})}}).controller("Search",function(o,e){e.jsonp("https://api.instagram.com/v1/media/popular/?access_token="+o.token+"&callback=JSON_CALLBACK").success(function(e){o.searchPhotos=e,o.searchTimeline=o.searchPhotos.data}),o.search=function(){e.jsonp("https://api.instagram.com/v1/tags/"+o.hashtag+"/media/recent?&access_token="+o.token+"&callback=JSON_CALLBACK").success(function(e){o.searchPhotos=e,o.searchTimeline=o.searchPhotos.data})},o.$watch("hashtag",function(){o.hashtag=o.hashtag.replace(/\s+/g,"")})}).controller("Timeline",function(o,e){e.jsonp("https://api.instagram.com/v1/users/self/feed?access_token="+o.token+"&callback=JSON_CALLBACK").success(function(e){o.pictures=e,o.timeline=o.pictures.data}),o.comment=function(t,s){e({method:"GET",params:{access_token:o.token,photoId:t,text:s},url:"../php/comment.php"}).success(function(o){console.log(o)})},myApp.loadOnScroll(o,e,"pictures","timeline")}).controller("Followers",function(o,e,t){e.jsonp("https://api.instagram.com/v1/users/"+t.id+"/"+"followed-by"+"?access_token="+o.token+"&callback=JSON_CALLBACK").success(function(t){o.followersData=t,o.followers=t.data,myApp.addStatus(o,e)}),myApp.loadOnScroll(o,e,"followersData","followers",myApp.addStatus)}).controller("follows",function(o,e,t){e.jsonp("https://api.instagram.com/v1/users/"+t.id+"/"+"follows"+"?access_token="+o.token+"&callback=JSON_CALLBACK").success(function(t){o.followersData=t,o.followers=t.data,myApp.addStatus(o,e)}),myApp.loadOnScroll(o,e,"followersData","followers",myApp.addStatus)}).controller("GetProfilePhotos",function(o,e,t){t.id||(t.id=o.userId),e.jsonp("https://api.instagram.com/v1/users/"+t.id+"/media/recent?access_token="+o.token+"&callback=JSON_CALLBACK").success(function(e){o.userPhotoData=e,o.userPhotos=o.userPhotoData.data}),myApp.loadOnScroll(o,e,"userPhotoData","userPhotos")});myApp.loadOnScroll=function(o,e,t,s,l){var a=0;window.addEventListener("scroll",function(){var c=document.body,n=c.scrollTop;n>a&&n>=c.scrollHeight-window.innerHeight-50&&e.jsonp(o[t].pagination.next_url+"&callback=JSON_CALLBACK").success(function(a){o[t]=a,o[s]=o[s].concat(o[t].data),l&&l(o,e)}),a=n})},myApp.addStatus=function(o,e){angular.forEach(o.followers,function(t,s){e.jsonp("https://api.instagram.com/v1/users/"+o.followers[s].id+"/relationship?access_token="+o.token+"&callback=JSON_CALLBACK").success(function(e){o.followers[s].status=e.data})})};