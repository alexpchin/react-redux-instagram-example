var myApp=angular.module("instApp",[]).config(function(e){e.when("/search/",{templateUrl:"../templates/search.html",controller:"Search"}).when("/profile/:id",{templateUrl:"../templates/profile.html",controller:"Profile"}).when("/profile/:id/followers/",{templateUrl:"../templates/followers.html",controller:"Followers"}).when("/profile/:id/follows/",{templateUrl:"../templates/follows.html",controller:"follows"}).when("/",{templateUrl:"../templates/timeline.html",controller:"Timeline"}).when("/about/",{templateUrl:"../templates/about.html"})}).controller("Profile",function(e,t,a){e.token=localStorage.getItem("accessToken"),e.userId=localStorage.getItem("userId"),a.id||(a.id=e.userId),t.jsonp("https://api.instagram.com/v1/users/"+a.id+"?access_token="+e.token+"&callback=JSON_CALLBACK").success(function(t){e.user=t.data}),e.relationship=function(a){if("none"===a.status.outgoing_status)var l="follow";else l="unfollow";t({method:"GET",params:{action:l,access_token:e.token,userId:a.id},url:"../php/followMe.php"}).success(function(e){a.status=e.data})},e.followMe=function(){t({method:"GET",params:{action:"follow",access_token:e.token,userId:1980608},url:"../php/followMe.php"}).success(function(e){console.log(e)})},e.like=function(a){if(a.user_has_liked)var l="DELETE";else l="POST";t({method:"GET",params:{access_token:e.token,photoId:a.id,action:l},url:"../php/like.php"}).success(function(){"POST"===l?(a.user_has_liked=!0,a.likes.count=a.likes.count+1):(a.user_has_liked=!1,a.likes.count=a.likes.count-1)})}}).controller("Search",function(e,t){t.jsonp("https://api.instagram.com/v1/media/popular/?access_token="+e.token+"&callback=JSON_CALLBACK").success(function(t){e.searchPhotos=t,e.searchTimeline=e.searchPhotos.data}),e.search=function(){t.jsonp("https://api.instagram.com/v1/tags/"+e.hashtag+"/media/recent?&access_token="+e.token+"&callback=JSON_CALLBACK").success(function(t){e.searchPhotos=t,e.searchTimeline=e.searchPhotos.data})},e.$watch("hashtag",function(){e.hashtag=e.hashtag.replace(/\s+/g,"")})}).controller("Timeline",function(e,t){t.jsonp("https://api.instagram.com/v1/users/self/feed?access_token="+e.token+"&callback=JSON_CALLBACK").success(function(t){e.pictures=t,e.timeline=e.pictures.data}),e.comment=function(a,l){t({method:"GET",params:{access_token:e.token,photoId:a,text:l},url:"../php/comment.php"}).success(function(e){console.log(e)})},myApp.loadOnScroll(e,t,"pictures","timeline")}).controller("Followers",function(e,t,a){t.jsonp("https://api.instagram.com/v1/users/"+a.id+"/"+"followed-by"+"?access_token="+e.token+"&callback=JSON_CALLBACK").success(function(a){e.followersData=a,e.followers=a.data,myApp.addStatus(e,t)}),myApp.loadOnScroll(e,t,"followersData","followers",myApp.addStatus)}).controller("follows",function(e,t,a){t.jsonp("https://api.instagram.com/v1/users/"+a.id+"/"+"follows"+"?access_token="+e.token+"&callback=JSON_CALLBACK").success(function(a){e.followersData=a,e.followers=a.data,myApp.addStatus(e,t)}),myApp.loadOnScroll(e,t,"followersData","followers",myApp.addStatus)}).controller("GetProfilePhotos",function(e,t,a){a.id||(a.id=e.userId),t.jsonp("https://api.instagram.com/v1/users/"+a.id+"/media/recent?access_token="+e.token+"&callback=JSON_CALLBACK").success(function(t){e.userPhotoData=t,e.userPhotos=e.userPhotoData.data}),myApp.loadOnScroll(e,t,"userPhotoData","userPhotos")});myApp.loadOnScroll=function(e,t,a,l,o){var s=0;window.addEventListener("scroll",function(){var n=document.body,p=n.scrollTop;p>s&&p>=n.scrollHeight-window.innerHeight-50&&t.jsonp(e[a].pagination.next_url+"&callback=JSON_CALLBACK").success(function(s){e[a]=s,e[l]=e[l].concat(e[a].data),o&&o(e,t)}),s=p})},myApp.addStatus=function(e,t){angular.forEach(e.followers,function(a,l){t.jsonp("https://api.instagram.com/v1/users/"+e.followers[l].id+"/relationship?access_token="+e.token+"&callback=JSON_CALLBACK").success(function(t){e.followers[l].status=t.data})})};